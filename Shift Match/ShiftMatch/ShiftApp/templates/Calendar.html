<!DOCTYPE html>
<html lang="en">

{% load static %}

<head>
    <meta charset="UTF-8" />
    <script src = 'https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script>

        document.addEventListener('DOMContentLoaded', function() {
            var calendarE1 = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarE1, {
                initialView: 'dayGridMonth',
                editable:true,
                selectable:true,
                timezone: 'UTC',
                allDay: false,
                events: {{ shifts|safe }},
                timeFormat: 'h:mm:ss ZZ',
            });
            calendar.render();
        })
    </script>
    <title>Calendar</title>
</head>

<body>
    <button hx-get="{% url 'addShift' %}" hx-target="#dialog">Add Shift</button>
    

    <div id='calendar'></div>

    <div id="modal" class="modal fade">
        <div id="dialog" class="modal-dialog" hx-target="this"></div>
    </div>
        
    <script src="https://unpkg.com/htmx.org@1.9.11" integrity="sha384-0gxUXCCR8yv9FM2b+U3FDbsKthCI66oH5IA9fHppQq9DDMHuMauqq1ZHBpJxQ0J0" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        (function(){

            const modal = new bootstrap.Modal(document.getElementById("modal"))

            htmx.on("htmx:afterSwap", (e) => {
                if (e.detail.target.id === "dialog") {
                    modal.show()
                }
            }) 
        })()
        
    </script>
    <script>
        (function(){
            htmx.on("htmx:beforeSwap", (e) => {
                if (e.detail.target.id == "dialog" && !e.detail.xhr.response) {
                  modal.hide()
                  e.detail.shouldSwap = false
                }
              })
        })()
    </script>
</body>

</html>